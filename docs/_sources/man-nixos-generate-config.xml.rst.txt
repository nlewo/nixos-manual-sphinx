

:command:`nixos-generate-config`
8
NixOS

.. COMMENT: <refmiscinfo class="version"><xi:include href="version.txt" parse="text"/></refmiscinfo>

:command:`nixos-generate-config`
generate NixOS configuration modules

CMDSYN:  nixos-generate-config --force --root root --dir dir

Description
^^^^^^^^^^^

This command writes two NixOS configuration modules:

.. _None:

/etc/nixos/hardware-configuration.nix
_____________________________________

    This module sets NixOS configuration options based on your current
    hardware configuration. In particular, it sets the
    option to reflect all currently mounted file
    systems, the option to reflect active swap
    devices, and the options to ensure that
    the initial ramdisk contains any kernel modules necessary for mounting
    the root file system.

    If this file already exists, it is overwritten. Thus, you should not
    modify it manually. Rather, you should include it from your
    :file:`/etc/nixos/configuration.nix`, and re-run
    :command:`nixos-generate-config` to update it whenever your
    hardware configuration changes.

.. _None:

/etc/nixos/configuration.nix
____________________________

    This is the main NixOS system configuration module. If it already
    exists, it’s left unchanged. Otherwise,
    :command:`nixos-generate-config` will write a template for you
    to customise.

Options
^^^^^^^

This command accepts the following options:

.. _None:

--root
______

    If this option is given, treat the directory
    *root* as the root of the file system. This
    means that configuration files will be written to
    :file:`None`, and that
    any file systems outside of *root* are ignored
    for the purpose of generating the option.

.. _None:

--dir
_____

    If this option is given, write the configuration files to the directory
    *dir* instead of
    :file:`/etc/nixos`.

.. _None:

--force
_______

    Overwrite :file:`/etc/nixos/configuration.nix` if it already
    exists.

.. _None:

--no-filesystems
________________

    Omit everything concerning file systems and swap devices from the
    hardware configuration.

.. _None:

--show-hardware-config
______________________

    Don't generate :file:`configuration.nix` or
    :file:`hardware-configuration.nix` and print the hardware
    configuration to stdout only.

Examples
^^^^^^^^

This command is typically used during NixOS installation to write initial
configuration modules. For example, if you created and mounted the target
file systems on :file:`/mnt` and
:file:`/mnt/boot`, you would run:
::

    $ nixos-generate-config --root /mnt

The resulting file
:file:`/mnt/etc/nixos/hardware-configuration.nix` might look
like this:

::

    # Do not modify this file!  It was generated by ‘nixos-generate-config’
    # and may be overwritten by future invocations.  Please make changes
    # to /etc/nixos/configuration.nix instead.
    { config, pkgs, ... }:

    {
      imports =
        [ <nixos/modules/installer/scan/not-detected.nix>
        ];

      boot.initrd.availableKernelModules = [ "ehci_hcd" "ahci" ];
      boot.kernelModules = [ "kvm-intel" ];
      boot.extraModulePackages = [ ];

      fileSystems."/" =
        { device = "/dev/disk/by-label/nixos";
          fsType = "ext3";
          options = [ "rw" "data=ordered" "relatime" ];
        };

      fileSystems."/boot" =
        { device = "/dev/sda1";
          fsType = "ext3";
          options = [ "rw" "errors=continue" "user_xattr" "acl" "barrier=1" "data=writeback" "relatime" ];
        };

      swapDevices =
        [ { device = "/dev/sda2"; }
        ];

      nix.maxJobs = 8;
    }

It will also create a basic
:file:`/mnt/etc/nixos/configuration.nix`, which you should edit
to customise the logical configuration of your system. This file includes
the result of the hardware scan as follows:

::

      imports = [ ./hardware-configuration.nix ];

After installation, if your hardware configuration changes, you can run:
::

    $ nixos-generate-config

to update :file:`/etc/nixos/hardware-configuration.nix`. Your
:file:`/etc/nixos/configuration.nix` will
*not* be overwritten.


